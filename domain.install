<?php
// $Id$

/**
 * @file
 * Install file.
 */

/**
 * Implements hook_install()
 */
function domain_install() {
  switch ($GLOBALS['db_type']) {
    case 'mysqli':
    case 'mysql':
      db_query("CREATE TABLE {domain} (
        domain_id int(11) NOT NULL AUTO_INCREMENT,
        subdomain varchar(40) NOT NULL default '',
        sitename varchar(80) NOT NULL default '',
        scheme varchar(8) NOT NULL default 'http',
        valid varchar(1) NOT NULL default 1,        
        PRIMARY KEY  (domain_id),
        KEY subdomain (subdomain)
        ) /*!40100 DEFAULT CHARACTER SET UTF8 */ ");
      break;
    case 'pgsql':
      db_query("CREATE TABLE {domain} (
        domain_id serial,
        subdomain varchar(40) NOT NULL default '',
        sitename varchar(80) NOT NULL default '',
        scheme varchar(8) NOT NULL default 'http',   
        valid varchar(1) NOT NULL default 1,                
        PRIMARY KEY (domain_id)
        )");   
      db_query("CREATE INDEX {domain}_subdomain_idx ON {domain} (subdomain)");
      break;
  } 
  // Create the 'all' realm for Domain Access.
  db_query("INSERT INTO {node_access} VALUES (0, 0, 'domain_all', 1, 0, 0)");    
}

/**
 * Implements hook_uninstall()
 */
function domain_uninstall() {
  db_query("DROP TABLE {domain}");
  db_query("DELETE from {variable} WHERE name LIKE '%s%%'", 'domain_');
}

/**
 * Updates from beta6 to beta 7
 * Adds the valid column to the database.
 */
function domain_update_1() {
  $ret = array();

  switch ($GLOBALS['db_type']) {
    case 'mysql':
    case 'mysqli':
      $ret[] = update_sql("ALTER TABLE {domain} ADD COLUMN valid varchar(1) NOT NULL DEFAULT 1");
      break;
    case 'pgsql':
      db_add_column($ret, 'domain', 'valid', 'varchar(1)', array('not null' => TRUE, 'default' => 1));
      break;
  }

  return $ret;  
}
 