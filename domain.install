<?php
// $Id$

/**
 * @file
 * Install file.
 */

/**
 * Implements hook_install()
 */
function domain_install() {
  drupal_install_schema('domain');
}

/**
 * Implements hook_schema()
 */
function domain_schema() {
  $schema['domain'] = array(
    'fields' => array(
      'domain_id' => array('type' => 'serial', 'not null' => TRUE),
      'subdomain' => array('type' => 'varchar', 'length' => '255', 'not null' => TRUE, 'default' => ''),
      'sitename' => array('type' => 'varchar', 'length' => '255', 'not null' => TRUE, 'default' => ''),
      'scheme' => array('type' => 'varchar', 'length' => '8', 'not null' => TRUE, 'default' => 'http'),
      'valid' => array('type' => 'varchar', 'length' => '1', 'not null' => TRUE, 'default' => '1')),
    'primary key' => array('domain_id'),
    'indexes' => array(
      'subdomain' => array('subdomain')),
  );
  $schema['domain_access'] = array(
    'fields' => array(
      'nid' => array('type' => 'int', 'unsigned' => TRUE, 'not null' => TRUE, 'default' => 0),
      'gid' => array('type' => 'int', 'unsigned' => TRUE, 'not null' => TRUE, 'default' => 0),
      'realm' => array('type' => 'varchar', 'length' => '255', 'not null' => TRUE, 'default' => '')),
    'primary key' => array('nid', 'gid', 'realm'),
    'indexes' => array(
      'nid' => array('nid')),
  );
  return $schema;
}

/**
 * Implements hook_uninstall()
 */
function domain_uninstall() {
  drupal_uninstall_schema('domain');
  db_query("DELETE from {variable} WHERE name LIKE '%s%%'", 'domain_');
}

/**
 * Update note.
 *
 * Since versions prior to 5.x.1.0 are not supported, and ther are no schema changes from
 * 5.x.1 to 6.x.1, no update functions have been provided for Drupal 6.
 *
 * To upgrade from a release candidate, first upgrade the module to 5.x.1.0.  Then upgrade
 * to Drupal 6.
 *
 */

/**
 * Updates from 5.x.1.2 to 5.x.1.3.  This change affected the size
 * of the columns for 'subdomain' and 'sitename'.  See http://drupal.org/node/244142
 */
function domain_update_6100() {
  $ret = array();
  db_drop_index($ret, 'domain', 'subdomain');
  db_change_field($ret, 'domain', 'subdomain', 'subdomain', array('type' => 'varchar', 'length' => '255', 'not null' => TRUE, 'default' => ''));
  db_add_index($ret, 'domain', 'subdomain', array('subdomain'));
  db_change_field($ret, 'domain', 'sitename', 'sitename', array('type' => 'varchar', 'length' => '255', 'not null' => TRUE, 'default' => ''));
  return $ret;
}

/**
 * Updates from 6.x.1 to 6.x.2 by registering the bootstrap modules.
 */
function domain_update_6200() {
  $ret = array();
  domain_bootstrap_register();
  return $ret;
}
